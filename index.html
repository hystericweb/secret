<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRUGO - Interactive 3D Bottle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Futura', 'Arial Narrow', sans-serif;
            overflow: hidden;
            background-color: #ce3368;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
        }
        
        .title {
            position: absolute;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            font-size: 6rem;
            font-weight: 900;
            color: #2d3748;
            letter-spacing: -0.05em;
            font-stretch: extra-condensed;
            text-align: center;
            z-index: 10;
        }
        
        #frugon {
            position: absolute;
            width: 150px;
            height: auto;
            pointer-events: none;
            z-index: 5;
            transition: none;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            color: #4a5568;
        }
        
        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            color: #e53e3e;
            text-align: center;
            max-width: 80%;
        }
    </style>
</head>
<body>
    <h1 class="title">FRUGO</h1>
    <img id="frugon" src="frugon.png" alt="Frugon character">
    <div id="container"></div>
    <div id="loading" class="loading">Loading model...</div>
    <div id="error" class="error" style="display: none;"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <script>
        let scene, camera, renderer, bottle;
        let mouse = { x: 0, y: 0 };
        let targetRotation = { x: 0, y: 0 };
        let currentRotation = { x: 0, y: 0 };
        let bottleScreenPos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
        let frugonPos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
        let frugonTargetPos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
        let walkOffset = 0;
        
        const container = document.getElementById('container');
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const frugonEl = document.getElementById('frugon');

        // Scene setup
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xce3368);

        // Camera setup
        camera = new THREE.PerspectiveCamera(
            45,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        camera.position.z = 15;

        // Renderer setup
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        container.appendChild(renderer.domElement);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(ambientLight);

        const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight1.position.set(5, 5, 5);
        scene.add(directionalLight1);

        const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.3);
        directionalLight2.position.set(-5, 3, -5);
        scene.add(directionalLight2);

        // Create cel-shaded green material
        const greenGlassMaterial = new THREE.MeshToonMaterial({
            color: 0x176634,
            transparent: false,
        });

        // Load GLTF model
        const loader = new THREE.GLTFLoader();
        loader.load(
            'frugo.glb',
            function(gltf) {
                bottle = gltf.scene;
                
                // Apply green glass material to meshes without textures
                bottle.traverse(function(child) {
                    if (child.isMesh) {
                        // Check if material has a texture map
                        const hasTexture = child.material.map !== null && child.material.map !== undefined;
                        
                        // If no texture, apply green glass material
                        if (!hasTexture) {
                            child.material = greenGlassMaterial;
                        }
                    }
                });
                
                scene.add(bottle);
                loadingEl.style.display = 'none';
                
                // Center and scale the model
                const box = new THREE.Box3().setFromObject(bottle);
                const center = box.getCenter(new THREE.Vector3());
                bottle.position.sub(center);
                
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = 5 / maxDim;
                bottle.scale.set(scale, scale, scale);
            },
            function(progress) {
                console.log('Loading:', (progress.loaded / progress.total * 100) + '%');
            },
            function(error) {
                console.error('Error loading model:', error);
                loadingEl.style.display = 'none';
                errorEl.textContent = 'Could not load frugo.glb model. Make sure the file is in the same directory.';
                errorEl.style.display = 'block';
            }
        );

        // Mouse move handler
        window.addEventListener('mousemove', function(e) {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            
            targetRotation.y = mouse.x * Math.PI;
            targetRotation.x = mouse.y * Math.PI * 0.5;
            
            // Update bottle screen position based on cursor
            bottleScreenPos.x = e.clientX;
            bottleScreenPos.y = e.clientY;
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            if (bottle) {
                // Smooth rotation interpolation
                currentRotation.x += (targetRotation.x - currentRotation.x) * 0.05;
                currentRotation.y += (targetRotation.y - currentRotation.y) * 0.05;
                
                bottle.rotation.x = currentRotation.x;
                bottle.rotation.y = currentRotation.y;

                // Follow cursor with bottle position
                bottle.position.x = mouse.x * 2;
                bottle.position.y = mouse.y * 1.5;
            }
            
            // Update Frugon position with 1 second delay (smooth interpolation)
            const delayFactor = 0.002; // Approximates 1 second delay
            frugonTargetPos.x = bottleScreenPos.x + 200; // Offset to the right of bottle
            frugonTargetPos.y = bottleScreenPos.y;
            
            // Smooth movement towards target
            frugonPos.x += (frugonTargetPos.x - frugonPos.x) * delayFactor;
            frugonPos.y += (frugonTargetPos.y - frugonPos.y) * delayFactor;
            
            // Calculate movement speed for walking animation
            const dx = frugonTargetPos.x - frugonPos.x;
            const dy = frugonTargetPos.y - frugonPos.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            // Walking animation - wiggle up and down
            if (distance > 5) { // Only animate when moving
                walkOffset = Math.sin(Date.now() * 0.01) * 10;
            } else {
                walkOffset = 0;
            }
            
            // Apply position to Frugon image
            frugonEl.style.left = (frugonPos.x - 75) + 'px'; // Center the image
            frugonEl.style.top = (frugonPos.y - 75 + walkOffset) + 'px';

            renderer.render(scene, camera);
        }
        animate();

        // Handle window resize
        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
